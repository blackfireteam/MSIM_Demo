(window.webpackJsonp=window.webpackJsonp||[]).push([["singleChat"],{"10a7":function(e,t,a){},"13c9":function(e,t,a){"use strict";a("87e6")},"3dec":function(e,t,a){"use strict";a("10a7")},"48bb":function(e,t,a){},5394:function(e,t,a){},"58f1":function(e,t,a){},"58f2":function(e,t,a){"use strict";a("58f1")},"5ec5":function(e,t,a){"use strict";a("e19c")},"6b86":function(e,t,a){"use strict";a.r(t);var n=a("7a23"),c={class:"chat_cont"},s={class:"chat_left"},o={class:"chat_right"};var l=a("24ec"),r=a.n(l);Object(n.z)("data-v-1dfb9302");var i={key:0,class:"message_wrapper"},u={key:1,class:"no_chat"},d=[Object(n.g)("img",{src:r.a,alt:""},null,-1),Object(n.g)("div",{class:"tip"},"No messages.",-1),Object(n.g)("div",{class:"des"},"You can search someone and send out a message first!",-1)];Object(n.x)();var f=a("5502"),b=a("5d7c");Object(n.z)("data-v-49fd42e1");var h={key:0,class:"has_more"},m=[Object(n.g)("span",{class:"has_more_tip"},"没有更多数据了",-1)];Object(n.x)();a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");var g=a("06c5");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,c,s=[],o=!0,l=!1;try{for(a=a.call(e);!(o=(n=a.next()).done)&&(s.push(n.value),!t||s.length!==t);o=!0);}catch(e){l=!0,c=e}finally{try{o||null==a.return||a.return()}finally{if(l)throw c}}return s}}(e,t)||Object(g.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a("4160"),a("159b"),a("c740"),a("4ec9");var p=a("b4bb");Object(n.z)("data-v-fb3098c0");var O={class:"flash_wrapper"},j={class:"close_btn"},I={class:"count_time"},y={key:0,class:"text_preview"},w=["src"];Object(n.x)();a("a9e3");var E={props:{curDate:Number},setup:function(){var e=Object(n.A)({message:{},isShow:!1});return{data:e,open:function(t){e.message=t,e.isShow=!0},hide:function(){e.isShow=!1,e.message={}},onload:function(){e.message.flashTime||(e.message.flashTime=Date.now()+e.message.flashTimeCount)}}}};a("8dd3");E.render=function(e,t,a,c,s,o){return Object(n.O)((Object(n.w)(),Object(n.f)("div",O,[Object(n.g)("div",{class:"flash_cover",onClick:t[0]||(t[0]=function(){return c.hide&&c.hide.apply(c,arguments)})}),Object(n.g)("span",j,[Object(n.g)("b",I,Object(n.H)(c.data.message.flashTime?Math.floor((c.data.message.flashTime-a.curDate)/1e3):c.data.message.flashTimeCount/1e3)+"s ",1),Object(n.g)("i",{class:"iconfont icon-delete",onClick:t[1]||(t[1]=function(){return c.hide&&c.hide.apply(c,arguments)})})]),0===c.data.message.type?(Object(n.w)(),Object(n.f)("div",y,Object(n.H)(c.data.message.text),1)):1===c.data.message.type?(Object(n.w)(),Object(n.f)("img",{key:1,src:c.data.message.url,class:"img_preview",onLoad:t[2]||(t[2]=function(){return c.onload&&c.onload.apply(c,arguments)}),alt:""},null,40,w)):Object(n.e)("",!0)],512)),[[n.L,c.data.isShow]])},E.__scopeId="data-v-fb3098c0";var M=E,C=a("23ed");var S={emits:["resendMsg"],components:{MsgItem:p.a,PreviewFlash:M,ScrollWrapper:C.a},props:{curChat:Object},setup:function(e){var t=Object(f.b)(),a=Object(n.l)().appContext.config.globalProperties,c=Object(n.A)({showImageViewer:!1,imageListIndex:0,hasMore:!0,curDate:0}),s=Object(n.B)("msgList"),o=Object(n.b)((function(){return t.state.msgList})),l=Object(n.b)((function(){var e=[];return o.value.forEach((function(t){t.type===a.$IM.TYPES.MSG_TYPE.Img&&e.push({url:t.url,onlyId:t.onlyId})})),e})),r=Object(n.b)((function(){var t=null;return o.value.forEach((function(a){var n;a.fromUid!==(null===(n=e.curChat)||void 0===n?void 0:n.uid)&&(t=a.onlyId)})),t})),i=!1,u=null,d=null;function b(e){t.commit("updateMsgs",e.data)}function h(e){t.commit("revokeMsgs",e.data)}function m(e){t.commit("deleteMsgs",e.data)}function g(a){var n;if((null===(n=e.curChat)||void 0===n?void 0:n.conversationID)===a.data.conversationID){var c=w.get(a.data.msgId);(!c||c.flashTime<=Date.now())&&(c&&w.delete(c.msgId),t.commit("readFlashMsg",a.data))}}function p(n){var s;i=!0,a.$msim.getMessageList({conversationID:null===(s=e.curChat)||void 0===s?void 0:s.conversationID,msgEnd:n}).then((function(e){var a=e.data.messages;c.hasMore=e.data.hasMore,a&&a.length>0&&(t.commit("addMsgs",a),n||O())})).catch((function(e){a.$message({type:"error",message:(null==e?void 0:e.msg)||e})})).finally((function(){i=!1}))}function O(){setTimeout((function(){var e;null===(e=s.value)||void 0===e||e.setScrollBottom()}),0)}Object(n.M)((function(){return[e.curChat,o.value.length]}),(function(e,t){var a=v(e,2),n=a[0],c=a[1],o=v(t,2),l=o[0],r=o[1];if((null==n?void 0:n.conversationID)!==(null==l?void 0:l.conversationID)&&p(),c>r){var i,u=null===(i=s.value)||void 0===i?void 0:i.getScrollYData();if(!u||u.scrollHeight<=u.clientHeight)return;u.scrollHeight-u.scrollTop-u.clientHeight<100&&O()}})),Object(n.u)((function(){a.$msim.on(a.$IM.EVENT.MESSAGE_RECEIVED,b),a.$msim.on(a.$IM.EVENT.MESSAGE_REVOKED,h),a.$msim.on(a.$IM.EVENT.MESSAGE_DELETE,m),a.$msim.on(a.$IM.EVENT.MESSAGE_READ_FLASH,g),0===o.value.length?p():O()})),Object(n.t)((function(){a.$msim.off(a.$IM.EVENT.MESSAGE_RECEIVED),a.$msim.off(a.$IM.EVENT.MESSAGE_REVOKED),a.$msim.off(a.$IM.EVENT.MESSAGE_DELETE),a.$msim.off(a.$IM.EVENT.MESSAGE_READ_FLASH),t.commit("clearMsgs")}));var j=Object(n.B)(),I=null,y=null,w=new Map;function E(e){I||(c.curDate=Date.now(),I=setInterval((function(){c.curDate=Date.now(),w.forEach((function(e,a){e.flashTime<=c.curDate&&(t.commit("readFlashMsg",e),w.delete(e.msgId),y&&e.msgId===y.msgId&&(I=null,j.value.hide()))}))}),1e3)),e.flashTimeCount||(!function(e){switch(e.type){case 0:e.flashTimeCount=1e3*(Math.ceil(.2*e.text.length)+5);break;case 1:e.flashTimeCount=2e4;break;case 2:e.flashTimeCount=1e3*(e.duration<4?5:e.duration+2)}}(e),0===e.type&&(e.flashTime=Date.now()+e.flashTimeCount),w.set(e.msgId,e),a.$msim.setReadFlash({conversationID:e.conversationID,msgId:e.msgId})),0!==e.type&&1!==e.type||(y=e,j.value.open(e))}function M(){u.pause(),d.stop(),u=null,d=null}return{data:c,msgRef:s,revoke:function(e){a.$msim.revokeMessage({conversationID:e.conversationID,msgId:e.msgId}).then((function(t){e.type=31,a.$message({type:"success",message:"撤回成功"})})).catch((function(e){a.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},msgScroll:function(e){var t=e.scrollTop,a=e.clientHeight,n=e.scrollHeight;i||!1===c.hasMore||t<200&&n>a&&o.value&&o.value.length>0&&p(o.value[0].msgId)},scrollBottom:O,showPreview:function(e){e.type===a.$IM.TYPES.MSG_TYPE.Img&&(c.imageListIndex=l.value.findIndex((function(t){return t.onlyId===e.onlyId})),c.showImageViewer=!0)},playSound:function(e){d&&M(),d=e,(u=document.createElement("audio")).src=e.message.url;var t=e.message;t.flash&&!e.isSelf&&(E(t),t.flashTime||u.addEventListener("loadeddata",(function(){t.flashTime=Date.now()+t.flashTimeCount}))),e.play();var a=u.play();u.addEventListener("ended",(function(){M()})),a&&a.catch((function(){M()}))},stopSound:M,seeFlash:E,msgList:o,myLastMsgOnlyId:r,flashRef:j}}};a("a3d5");S.render=function(e,t,a,c,s,o){var l=Object(n.E)("MsgItem"),r=Object(n.E)("scroll-wrapper"),i=Object(n.E)("PreviewFlash");return Object(n.w)(),Object(n.f)(n.a,null,[Object(n.j)(r,{class:"message_list",ref:"msgRef",onScroll:c.msgScroll},{default:Object(n.N)((function(){return[c.data.hasMore?Object(n.e)("",!0):(Object(n.w)(),Object(n.f)("div",h,m)),(Object(n.w)(!0),Object(n.f)(n.a,null,Object(n.C)(c.msgList,(function(t){var s,o,r;return Object(n.w)(),Object(n.d)(l,{key:t.msgId,message:t,curDate:t.flash&&t.fromUid===(null===(s=a.curChat)||void 0===s?void 0:s.uid)?c.data.curDate:0,isSelf:t.fromUid!==(null===(o=a.curChat)||void 0===o?void 0:o.uid),msgLastRead:(null===(r=a.curChat)||void 0===r?void 0:r.msgLastRead)||0,myLastMsgOnlyId:c.myLastMsgOnlyId,onShowPreview:function(e){return c.showPreview(t)},onSeeFlash:function(e){return c.seeFlash(t)},onPlaySound:c.playSound,onStopSound:c.stopSound,onRevoke:c.revoke,onResend:function(){return e.$emit("resendMsg",t)}},null,8,["message","curDate","isSelf","msgLastRead","myLastMsgOnlyId","onShowPreview","onSeeFlash","onPlaySound","onStopSound","onRevoke","onResend"])})),128))]})),_:1},8,["onScroll"]),Object(n.j)(i,{ref:"flashRef",curDate:c.data.curDate},null,8,["curDate"])],64)},S.__scopeId="data-v-49fd42e1";var _=S,D=a("54c4"),T={components:{MsgHeader:b.a,MessageList:_,SendMessage:D.a},setup:function(){var e=Object(f.b)(),t=Object(n.B)("sendMsg"),a=Object(n.B)("msgListWrapper");return{sendRef:t,msgListRef:a,scrollB:function(){a.value.scrollBottom()},resend:function(e){t.value.sendMsg(e)},curChat:Object(n.b)((function(){return e.state.curChat}))}}};a("3dec");T.render=function(e,t,a,c,s,o){var l,r,f=Object(n.E)("MsgHeader"),b=Object(n.E)("MessageList"),h=Object(n.E)("SendMessage");return null!==(l=c.curChat)&&void 0!==l&&l.conversationID?(Object(n.w)(),Object(n.f)("div",i,[Object(n.j)(f,{curChat:c.curChat},null,8,["curChat"]),Object(n.j)(b,{curChat:c.curChat,onResendMsg:c.resend,ref:"msgListRef"},null,8,["curChat","onResendMsg"]),Object(n.j)(h,{to:null===(r=c.curChat)||void 0===r?void 0:r.uid,onScrollB:c.scrollB,ref:"sendRef"},null,8,["to","onScrollB"])])):(Object(n.w)(),Object(n.f)("div",u,d))},T.__scopeId="data-v-1dfb9302";var L=T;Object(n.z)("data-v-3050e54d");var k={class:"bar_right"},V=Object(n.g)("div",{class:"space"},null,-1),$=Object(n.g)("div",{class:"space"},null,-1),R={class:"chat_dialog_footer"};Object(n.x)();a("7db0");Object(n.z)("data-v-12836ecb");var x={class:"avatar"},B={class:"avatar_img"},A={class:"info"},H={class:"user_info_item"},N={class:"info_left"},P={class:"user_name wrap"},F={class:"is_online"},z={class:"last_msg_time"},G={class:"user_info_item"},U={class:"last_msg wrap"},K={class:"badge"},Y={class:"badge_icon"};Object(n.x)();var W=a("2095"),q={props:{chat:Object,isCurChat:Boolean,isOnline:Boolean,userInfo:{type:Object,default:{}}},setup:function(){return{formatLastTime:W.a}}};a("5ec5");q.render=function(e,t,a,c,s,o){var l=Object(n.F)("lazy");return Object(n.w)(),Object(n.f)("div",{class:Object(n.q)(["chat_item",{active_item:a.isCurChat}])},[Object(n.g)("div",x,[Object(n.O)(Object(n.g)("img",B,null,512),[[l,a.userInfo.avatar]])]),Object(n.g)("div",A,[Object(n.g)("div",H,[Object(n.g)("div",N,[Object(n.g)("span",P,Object(n.H)(a.userInfo.nickName||a.chat.conversationID),1),Object(n.O)(Object(n.g)("span",F,null,512),[[n.L,a.isOnline]])]),Object(n.g)("span",z,Object(n.H)(c.formatLastTime(a.chat.showTime)),1)]),Object(n.g)("div",G,[Object(n.g)("div",U,Object(n.H)(1===a.chat.showMsgType?"[图片]":2===a.chat.showMsgType?"[音频]":3===a.chat.showMsgType?"[视频]":4===a.chat.showMsgType?"[位置]":6===a.chat.showMsgType?"[自定义表情]":7===a.chat.showMsgType?"[闪照]":31===a.chat.showMsgType?"[已撤回]":a.chat.showMsg),1),Object(n.O)(Object(n.g)("div",K,[Object(n.g)("span",Y,Object(n.H)(a.chat.unread),1)],512),[[n.L,!a.isCurChat&&a.chat.unread>0]])])])],2)},q.__scopeId="data-v-12836ecb";var J=q,Q=a("2a52"),X=a("fb37"),Z=a("71ca"),ee={components:{Dialog:Q.a,InputD:X.a,ButtonD:Z.a,ChatItem:J,ScrollWrapper:C.a},setup:function(){var e=Object(n.l)().appContext.config.globalProperties,t=Object(f.b)(),a=Object(n.b)((function(){return t.state.curChat})),c=Object(n.b)((function(){return t.state.chatList})),s=Object(n.b)((function(){return t.state.profiles})),o=Object(n.b)((function(){return t.state.onlineUsers})),l=Object(n.A)({dialogVisible:!1,userId:null,hasMore:!0}),r=Object(n.B)("chatList");function i(t){var a=[];t.forEach((function(e){var t=s.value.get(e.uid);t&&t.custom||a.push({uid:e.uid})})),a.length>0&&e.$msim.getProfileList(a)}function u(n){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.$msim.getConversationList({conversationID:n,pageSize:20}).then((function(e){var n=e.data.chats;l.hasMore=e.data.hasMore,n.length>0&&(i(n),c?t.commit("refreshChats",n):t.commit("updateChats",n),a.value.uid||d(n[0]))})).catch((function(t){e.$message({type:"error",message:(null==t?void 0:t.msg)||t})}))}function d(e){var n;(null===(n=a.value)||void 0===n?void 0:n.conversationID)!==(null==e?void 0:e.conversationID)&&t.commit("changeChat",e)}function b(){l.userId=null,l.dialogVisible=!1}return Object(n.u)((function(){c.value.length<20&&u()})),Object(n.M)((function(){var e;return null===(e=a.value)||void 0===e?void 0:e.unread}),(function(t,n){var c;t>0&&(c=a.value.conversationID,e.$msim.setMessageRead({conversationID:c}))})),{data:l,cancel:b,contact:function(){if(!l.userId||l.userId==t.state.curUserId||a.value&&l.userId==a.value.uid)b();else{var e=c.value.find((function(e){return e.uid==l.userId}));e||(e={conversationID:"C2C_"+l.userId,uid:l.userId},t.commit("addChat",e)),t.commit("changeChat",e),b()}},chatRef:r,chatList:c,curChat:a,userInfos:s,onlineUsers:o,chatScroll:function(e){var t=e.scrollTop,a=e.clientHeight,n=e.scrollHeight;if(!1!==l.hasMore){var s=c.value;if(t+a+100>=n)if(s&&s.length>0)u(s[s.length-1].conversationID)}},chatChange:d,refresh:function(){u(null,!0)}}}};a("ed5e");ee.render=function(e,t,a,c,s,o){var l=Object(n.E)("ChatItem"),r=Object(n.E)("scroll-wrapper"),i=Object(n.E)("InputD"),u=Object(n.E)("ButtonD"),d=Object(n.E)("Dialog");return Object(n.w)(),Object(n.f)(n.a,null,[Object(n.g)("div",k,[Object(n.j)(r,{class:"chat_list",ref:"chatRef",onScroll:c.chatScroll},{default:Object(n.N)((function(){return[V,(Object(n.w)(!0),Object(n.f)(n.a,null,Object(n.C)(c.chatList,(function(e){return Object(n.w)(),Object(n.d)(l,{class:Object(n.q)("scroll_chat_key_"+e.conversationID),key:e.conversationID,onClick:function(t){return c.chatChange(e)},isCurChat:e.conversationID===c.curChat.conversationID,chat:e,isOnline:c.onlineUsers.has(e.uid),userInfo:c.userInfos.get(e.uid)},null,8,["class","onClick","isCurChat","chat","isOnline","userInfo"])})),128)),$]})),_:1},8,["onScroll"])]),Object(n.j)(d,{title:"快速发起会话",modelValue:c.data.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=function(e){return c.data.dialogVisible=e}),"before-close":c.cancel,width:"400px"},{footer:Object(n.N)((function(){return[Object(n.g)("div",R,[Object(n.j)(u,{isBlock:!1,size:"small",type:"cancel",text:"取 消",onClick:c.cancel},null,8,["onClick"]),Object(n.j)(u,{isBlock:!1,size:"small",text:"确 定",onClick:c.contact},null,8,["onClick"])])]})),default:Object(n.N)((function(){return[Object(n.g)("div",null,[Object(n.j)(i,{modelValue:c.data.userId,"onUpdate:modelValue":t[0]||(t[0]=function(e){return c.data.userId=e}),maxlength:"11",placeholder:"用户手机号"},null,8,["modelValue"])])]})),_:1},8,["modelValue","before-close"])],64)},ee.__scopeId="data-v-3050e54d";var te={components:{ChatList:ee,MessageWrapper:L},setup:function(){}};a("58f2");te.render=function(e,t,a,l,r,i){var u=Object(n.E)("ChatList"),d=Object(n.E)("MessageWrapper");return Object(n.w)(),Object(n.f)("div",c,[Object(n.g)("div",s,[Object(n.j)(u)]),Object(n.g)("div",o,[Object(n.j)(d)])])};t.default=te},"87e6":function(e,t,a){},"8dd3":function(e,t,a){"use strict";a("5394")},a3d5:function(e,t,a){"use strict";a("efaf")},e19c:function(e,t,a){},ed5e:function(e,t,a){"use strict";a("48bb")},efaf:function(e,t,a){},fb37:function(e,t,a){"use strict";var n=a("7a23");Object(n.z)("data-v-43282bc1");var c={class:"input_wrapper"},s=["type","readonly","disabled","placeholder","maxlength"];Object(n.x)();a("a9e3"),a("a15b"),a("fb6a"),a("a630"),a("3ca3");var o={emits:["blur","change","keydown","update:modelValue","input"],props:{modelValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"},icon:String,readonly:Boolean,disabled:Boolean,errMsg:String,maxlength:{type:String,default:null},placeholder:String},setup:function(e,t){return{handleInput:function(a){var n=a.target.value;e.maxlength&&(n=Array.from(n).slice(0,Number(e.maxlength)).join("")),t.emit("update:modelValue",n),t.emit("input",n)},handleBlur:function(e){t.emit("blur",e.target.value)},handleChange:function(e){t.emit("change",e.target.value)},handleKeydown:function(e){t.emit("keydown",e)}}}};a("13c9");o.render=function(e,t,a,o,l,r){return Object(n.w)(),Object(n.f)("div",c,[Object(n.O)(Object(n.g)("input",{class:Object(n.q)(["input_default",{err:a.errMsg,disabled_input:a.disabled,icon_paddding:a.icon}]),type:a.inputType,"onUpdate:modelValue":t[0]||(t[0]=function(e){return a.modelValue=e}),spellcheck:"false",autocapitalize:"off",autocomplete:"off",readonly:a.readonly,disabled:a.disabled,placeholder:a.placeholder,maxlength:a.maxlength,onInput:t[1]||(t[1]=function(){return o.handleInput&&o.handleInput.apply(o,arguments)}),onBlur:t[2]||(t[2]=Object(n.Q)((function(){return o.handleBlur&&o.handleBlur.apply(o,arguments)}),["prevent"])),onChange:t[3]||(t[3]=function(){return o.handleChange&&o.handleChange.apply(o,arguments)}),onKeydown:t[4]||(t[4]=function(){return o.handleKeydown&&o.handleKeydown.apply(o,arguments)})},null,42,s),[[n.J,a.modelValue]]),a.icon?(Object(n.w)(),Object(n.f)("i",{key:0,class:Object(n.q)(["iconfont",a.icon])},null,2)):Object(n.e)("",!0)])},o.__scopeId="data-v-43282bc1";t.a=o}}]);