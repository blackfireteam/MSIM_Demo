(window.webpackJsonp=window.webpackJsonp||[]).push([["chatRoom"],{"07de":function(e,t,o){"use strict";o.r(t);var n=o("7a23");Object(n.z)("data-v-7200e74e");var a={class:"chat_room"},c={class:"chat_main_wrapper"};Object(n.x)();o("99af"),o("a15b");var i=o("5d7c"),s=o("54c4"),d=o("24ec"),l=o.n(d);Object(n.z)("data-v-9e0823d0");var u={key:0,class:"message_wrapper"},r=Object(n.g)("div",{class:"has_more"},[Object(n.g)("span",{class:"has_more_tip"},"没有更多数据了")],-1),m={key:1,class:"no_chat"},f=[Object(n.g)("img",{src:l.a,alt:""},null,-1),Object(n.g)("div",{class:"tip"},"No messages.",-1),Object(n.g)("div",{class:"des"},"You can search someone and send out a message first!",-1)];Object(n.x)();o("4160"),o("159b"),o("c740");var b=o("5502"),v=o("b4bb"),g=o("23ed"),O={components:{MsgItem:v.a,ScrollWrapper:g.a,SendMessage:s.a},props:{curChat:Object,roomInfo:Object},setup:function(e){var t=Object(b.b)(),o=Object(n.l)().appContext.config.globalProperties,a=Object(n.A)({showImageViewer:!1,imageListIndex:0}),c=Object(n.B)(),i=Object(n.B)(),s=Object(n.b)((function(){return t.state.roomMsgList})),d=Object(n.b)((function(){var e=[];return s.value.forEach((function(t){t.type===o.$IM.TYPES.MSG_TYPE.Img&&e.push({url:t.url,onlyId:t.onlyId})})),e})),l=null,u=null;function r(){Object(n.p)((function(){var e;null===(e=c.value)||void 0===e||e.setScrollBottom()}))}function m(){l.pause(),u.stop(),l=null,u=null}return Object(n.L)((function(){return s.value.length}),(function(e,t){if(0===t)r();else if(e>t){var o,n=null===(o=c.value)||void 0===o?void 0:o.getScrollYData();if(!n||n.scrollHeight<=n.clientHeight)return;n.scrollHeight-n.scrollTop-n.clientHeight<100&&r()}})),{data:a,msgRef:c,sendRef:i,resend:function(e){i.value.sendMsg(e)},revoke:function(e){window.$msim.revokeMessage({conversationID:e.conversationID,gtype:e.gtype,id:e.toUid,msgId:e.msgId}).then((function(t){e.type=31,o.$message({type:"success",message:"撤回成功"})})).catch((function(e){o.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},deleteMsg:function(e){window.$msim.deleteChatRoomMsgs({roomId:e.toUid,msgIds:[e.msgId]}).then((function(e){o.$message({type:"success",message:"删除成功"})})).catch((function(e){o.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},scrollBottom:r,showPreview:function(e){e.type===o.$IM.TYPES.MSG_TYPE.Img&&(a.imageListIndex=d.value.findIndex((function(t){return t.onlyId===e.onlyId})),a.showImageViewer=!0)},playSound:function(e){u&&m(),u=e,(l=document.createElement("audio")).src=e.message.url,e.play();var t=l.play();l.addEventListener("ended",(function(){m()})),t&&t.catch((function(){m()}))},stopSound:m,roomMsgList:s,curUserId:Object(n.b)((function(){return t.state.curUserId}))}}};o("e790");O.render=function(e,t,o,a,c,i){var s,d=Object(n.E)("MsgItem"),l=Object(n.E)("scroll-wrapper"),b=Object(n.E)("SendMessage");return o.roomInfo?(Object(n.w)(),Object(n.f)("div",u,[Object(n.j)(l,{class:"message_list",ref:"msgRef"},{default:Object(n.M)((function(){return[r,(Object(n.w)(!0),Object(n.f)(n.a,null,Object(n.C)(a.roomMsgList,(function(e){var t;return Object(n.w)(),Object(n.d)(d,{key:e.msgId,message:e,isSelf:e.fromUid!==a.curUserId,showRead:!1,isGroup:!0,isDelete:null===(t=o.roomInfo)||void 0===t?void 0:t.actionDelMsg,onShowPreview:function(t){return a.showPreview(e)},onPlaySound:a.playSound,onStopSound:a.stopSound,onRevoke:a.revoke,onResend:function(){return a.resend(e)}},null,8,["message","isSelf","isDelete","onShowPreview","onPlaySound","onStopSound","onRevoke","onResend"])})),128))]})),_:1},512),Object(n.j)(b,{to:null===(s=o.roomInfo)||void 0===s?void 0:s.id,chatType:e.$IM.TYPES.GROUP_TYPE.ChatRoom,onScrollB:a.scrollBottom,ref:"sendRef"},null,8,["to","chatType","onScrollB"])])):(Object(n.w)(),Object(n.f)("div",m,f))},O.__scopeId="data-v-9e0823d0";var h=O,p=o("c538"),j=o.n(p);Object(n.z)("data-v-57176e0e");var w={class:"chat_info_wrapper"},I={class:"info_title"},M={key:0,class:"member_list"},E=["onClick"],_=["title"],R=["title"],y={class:"info_cont"},T={class:"info_tod"},V=Object(n.i)(" 群公告："),$={class:"info_tod_edit"},S={key:0,class:"room_setting"},k=Object(n.i)(" 聊天室禁言管理： "),C={class:"member_card_wrapper"},D={class:"member_card_item"},x={class:"member_card_item"},P={key:0,class:"member_card_item"},N=Object(n.i)(" 禁言管理： "),U={key:1,class:"member_card_item"},G=Object(n.i)(" 设置管理员： ");Object(n.x)();o("a9e3");Object(n.z)("data-v-2228b2fb");var A=["maxlength","autofocus","rows","placeholder"];Object(n.x)();var L={props:{modelValue:String,placeholder:String,rows:{type:Number,default:1},maxLength:{type:Number,default:2e3},autofocus:{type:Boolean,default:!1}},setup:function(e,t){return{data:Object(n.A)({}),changeHeight:function(o){8===o.keyCode||""===e.textMsg?(o.target.style.height="inherit",o.target.style.height="".concat(o.target.scrollHeight,"px")):o.keyCode||(t.emit("update:modelValue",e.modelValue),o.target.style.height="".concat(o.target.scrollHeight,"px"))}}}};o("338b");L.render=function(e,t,o,a,c,i){return Object(n.N)((Object(n.w)(),Object(n.f)("textarea",{class:"text_area","onUpdate:modelValue":t[0]||(t[0]=function(e){return o.modelValue=e}),maxlength:o.maxLength,spellcheck:"false",autocapitalize:"off",autocorrect:"off",autocomplete:"off",autofocus:o.autofocus,rows:o.rows,placeholder:o.placeholder,onKeydown:t[1]||(t[1]=function(){return a.changeHeight&&a.changeHeight.apply(a,arguments)}),onInput:t[2]||(t[2]=function(){return a.changeHeight&&a.changeHeight.apply(a,arguments)})},null,40,A)),[[n.J,o.modelValue]])},L.__scopeId="data-v-2228b2fb";var B=L,H=o("71ca");var Y={props:{moduleValue:{type:[Number,String,Boolean],default:!1},activeVal:{type:[Number,String,Boolean],default:!0},inactiveVal:{type:[Number,String,Boolean],default:!1}},setup:function(e,t){return{changeVal:function(){var o=e.moduleValue===e.activeVal?e.inactiveVal:e.activeVal;t.emit("update:moduleValue",o),t.emit("change",o)}}}};o("494f");Y.render=function(e,t,o,a,c,i){return Object(n.w)(),Object(n.f)("div",{class:Object(n.q)(["switch_wrapper",{active:o.activeVal===o.moduleValue}]),onClick:t[0]||(t[0]=function(){return a.changeVal&&a.changeVal.apply(a,arguments)})},null,2)},Y.__scopeId="data-v-3a2eb5cc";var z=Y,K=o("2a52"),J={components:{MsTextArea:B,MsSwitch:z,ButtonD:H.a,Dialog:K.a},props:{roomId:Number,chatRoomInfo:Object},setup:function(e){var t=Object(n.l)().appContext.config.globalProperties,o=Object(n.A)({text:"",isEditTod:!1,isShowMemberDetail:!1,curMember:null});return{mute:function(n){window.$msim.muteChatRoom({roomId:e.roomId,isMute:n,reason:o.text}).then((function(e){t.$message({type:"success",message:!0===n?"聊天室设置禁言成功":"聊天室解除禁言成功"})})).catch((function(e){t.$message({type:"error",message:"".concat(!0===n?"聊天室设置禁言失败":"聊天室解除禁言失败","：").concat((null==e?void 0:e.msg)||e)})}))},openTod:function(){var t;o.isEditTod=!0,o.text=null===(t=e.chatRoomInfo)||void 0===t?void 0:t.tod},closeTod:function(){o.isEditTod=!1,o.text=""},editTod:function(){window.$msim.editChatRoomTOD({roomId:e.roomId,tod:o.text}).then((function(e){o.isEditTod=!1,o.text="",t.$message({type:"success",message:"发布公告成功"})})).catch((function(e){t.$message({type:"error",message:"发布公告失败：".concat((null==e?void 0:e.msg)||e)})}))},muteMembers:function(o){var n=o.uid;!1===o.isMute&&(n=-o.uid),window.$msim.muteMembers({roomId:e.roomId,uids:[n],duration:0,reason:"管理成员"}).then((function(e){t.$message({type:"success",message:!0===o.isMute?"禁言".concat(o.uid,"成功"):"解除禁言".concat(o.uid,"成功")})})).catch((function(e){t.$message({type:"error",message:"".concat(!0===o.isMute?"禁言":"解除禁言").concat(o.uid,"失败：").concat((null==e?void 0:e.msg)||e)})}))},setManagers:function(o){var n=o.uid;0===o.role&&(n=-o.uid),window.$msim.editChatRoomManagerAccess({roomId:e.roomId,uids:[n],duration:0,reason:"管理角色"}).then((function(e){t.$message({type:"success",message:0===o.role?"解除管理员成功":"设置管理员成功"})})).catch((function(e){t.$message({type:"error",message:"".concat(0===o.role?"解除管理员成功":"设置管理员成功","：").concat((null==e?void 0:e.msg)||e)})}))},showDetail:function(e){o.curMember=e,o.isShowMemberDetail=!0},closeDetail:function(){o.isShowMemberDetail=!1,o.curMember=null},data:o}}};o("5978");J.render=function(e,t,o,a,c,i){var s,d,l,u,r,m,f,b,v,g=Object(n.E)("MsTextArea"),O=Object(n.E)("ButtonD"),h=Object(n.E)("MsSwitch"),p=Object(n.E)("Dialog");return Object(n.w)(),Object(n.f)("div",w,[Object(n.g)("div",I,"群成员："+Object(n.G)(null===(s=o.chatRoomInfo)||void 0===s||null===(d=s.members)||void 0===d?void 0:d.length),1),(null===(l=o.chatRoomInfo)||void 0===l||null===(u=l.members)||void 0===u?void 0:u.length)>0?(Object(n.w)(),Object(n.f)("div",M,[(Object(n.w)(!0),Object(n.f)(n.a,null,Object(n.C)(null===(r=o.chatRoomInfo)||void 0===r?void 0:r.members,(function(e){return Object(n.w)(),Object(n.f)("div",{class:"member_item",key:e.uid,onClick:function(t){return a.showDetail(e)}},[Object(n.g)("img",{class:"member_avatar",title:0===e.role?"群成员":9===e.role?"管理员":"临时管理员",src:j.a,alt:""},null,8,_),Object(n.g)("div",{class:"member_name",title:e.uid},Object(n.G)(e.uid),9,R)],8,E)})),128))])):Object(n.e)("",!0),Object(n.g)("div",y,[Object(n.g)("div",T,[V,null!==(m=o.chatRoomInfo)&&void 0!==m&&m.actionTod&&!1===a.data.isEditTod?(Object(n.w)(),Object(n.f)("span",{key:0,class:"tod_edit_btn",onClick:t[0]||(t[0]=function(e){return a.openTod()})},"编辑")):null!==(f=o.chatRoomInfo)&&void 0!==f&&f.actionTod&&!0===a.data.isEditTod?(Object(n.w)(),Object(n.f)("span",{key:1,class:"tod_edit_btn",onClick:t[1]||(t[1]=function(e){return a.closeTod()})},"取消")):Object(n.e)("",!0)]),Object(n.N)(Object(n.g)("div",{class:"info_tod_show"},Object(n.G)((null===(b=o.chatRoomInfo)||void 0===b?void 0:b.tod)||"暂无公告内容"),513),[[n.K,!1===a.data.isEditTod]]),Object(n.N)(Object(n.g)("div",$,[Object(n.j)(g,{class:"edit_tod_input",modelValue:a.data.text,"onUpdate:modelValue":t[2]||(t[2]=function(e){return a.data.text=e}),rows:3,maxLength:300,placeholder:"Please enter announcement",onKeydown:Object(n.O)(Object(n.P)(a.editTod,["exact","prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),Object(n.j)(O,{size:"mini",text:"保存",onClick:a.editTod},null,8,["onClick"])],512),[[n.K,!0===a.data.isEditTod]]),null!==(v=o.chatRoomInfo)&&void 0!==v&&v.actionMuteAll?(Object(n.w)(),Object(n.f)("div",S,[k,Object(n.j)(h,{modelValue:o.chatRoomInfo.isMute,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.chatRoomInfo.isMute=e}),onChange:t[4]||(t[4]=function(e){return a.mute(o.chatRoomInfo.isMute)})},null,8,["modelValue"])])):Object(n.e)("",!0),Object(n.j)(O,{class:"leave_btn",type:"danger",size:"mini",text:"退出聊天室",onClick:t[5]||(t[5]=function(t){return e.$emit("leave")})})]),Object(n.j)(p,{title:"成员信息",modelValue:a.data.isShowMemberDetail,"onUpdate:modelValue":t[10]||(t[10]=function(e){return a.data.isShowMemberDetail=e}),showFooter:!1,onClose:a.closeDetail,width:"400px"},{default:Object(n.M)((function(){var e,c,i,s,d,l,u;return[Object(n.g)("div",C,[Object(n.g)("div",D,"UID："+Object(n.G)(null===(e=a.data.curMember)||void 0===e?void 0:e.uid),1),Object(n.g)("div",x," role："+Object(n.G)(0===(null===(c=a.data.curMember)||void 0===c?void 0:c.role)?"群成员":9===(null===(i=a.data.curMember)||void 0===i?void 0:i.role)?"管理员":"临时管理员"),1),9!==(null===(s=a.data.curMember)||void 0===s?void 0:s.role)&&null!==(d=o.chatRoomInfo)&&void 0!==d&&d.actionMute?(Object(n.w)(),Object(n.f)("div",P,[N,Object(n.j)(h,{modelValue:a.data.curMember.isMute,"onUpdate:modelValue":t[6]||(t[6]=function(e){return a.data.curMember.isMute=e}),onChange:t[7]||(t[7]=function(e){return a.muteMembers(a.data.curMember)})},null,8,["modelValue"])])):Object(n.e)("",!0),9!==(null===(l=a.data.curMember)||void 0===l?void 0:l.role)&&null!==(u=o.chatRoomInfo)&&void 0!==u&&u.actionAssign?(Object(n.w)(),Object(n.f)("div",U,[G,Object(n.j)(h,{modelValue:a.data.curMember.role,"onUpdate:modelValue":t[8]||(t[8]=function(e){return a.data.curMember.role=e}),activeVal:1,inactiveVal:0,onChange:t[9]||(t[9]=function(e){return a.setManagers(a.data.curMember)})},null,8,["modelValue"])])):Object(n.e)("",!0)])]})),_:1},8,["modelValue","onClose"])])},J.__scopeId="data-v-57176e0e";var F=J,W=o("6c02"),q={components:{MsgHeader:i.a,ChatRoomMsgList:h,SendMessage:s.a,RoomInfo:F},setup:function(){var e=Object(n.l)().appContext.config.globalProperties,t=Object(b.b)(),o=Object(W.d)(),a=Object(n.A)({chatRoomInfo:null}),c=Object(n.B)("sendMsg"),i=Object(n.B)("msgListWrapper");function s(){i.value.scrollBottom()}function d(e){}function l(e){a.chatRoomInfo=null,o.push({name:"chat"})}function u(e){t.commit("updateRoomMsgs",e.data)}function r(e){t.commit("revokeRoomMsg",e.data)}function m(e){t.commit("deleteRoomMsgs",e.data)}function f(t){t.data.id===a.chatRoomInfo.id&&t.data.gtype===a.chatRoomInfo.gtype&&(a.chatRoomInfo=null,e.$message.info({message:"聊天室已销毁"}),o.push({name:"chat"}))}function v(e){e.data.tip&&function(e){var o,n,a,c,i,s,d,l,u,r,m,f,b,v;switch(e.event){case 1:v="聊天室已被解散";break;case 2:v="聊天室属性已修改";break;case 3:v="管理员 ".concat(null===(o=e.uids)||void 0===o?void 0:o.shift()," 将本聊天室设为听众模式");break;case 4:v="管理员 ".concat(null===(n=e.uids)||void 0===n?void 0:n.shift()," 恢复聊天室发言功能");break;case 5:v="管理员 ".concat(null===(a=e.uids)||void 0===a?void 0:a.shift()," 上线");break;case 6:v="管理员 ".concat(null===(c=e.uids)||void 0===c?void 0:c.shift()," 下线");break;case 7:v="管理员 ".concat(null===(i=e.uids)||void 0===i?void 0:i.shift()," 将用户 ").concat(null===(s=e.uids)||void 0===s?void 0:s.shift(),"禁言");break;case 8:v="管理员 ".concat(null===(d=e.uids)||void 0===d?void 0:d.shift()," 将用户 ").concat(null===(l=e.uids)||void 0===l?void 0:l.join()," 等人禁言");break;case 9:v="".concat(null===(u=e.uids)||void 0===u?void 0:u.shift()," 成为本聊天室管理员");break;case 10:v="管理员 ".concat(null===(r=e.uids)||void 0===r?void 0:r.shift()," 指派 ").concat(null===(m=e.uids)||void 0===m?void 0:m.shift()," 为临时管理员");break;case 11:v="管理员 ".concat(null===(f=e.uids)||void 0===f?void 0:f.shift()," 指派 ").concat(null===(b=e.uids)||void 0===b?void 0:b.join()," 等人为临时管理员")}t.commit("addRoomMsg",{onlyId:"tip",type:"roomTip",msg:v})}(e.data.tip);var o=e.data.chatRoomInfo;o.id===a.chatRoomInfo.id&&o.gtype===a.chatRoomInfo.gtype&&Object.assign(a.chatRoomInfo,o)}function g(e){var t;e.data.id===(null===(t=a.chatRoomInfo)||void 0===t?void 0:t.id)&&(a.chatRoomInfo.tod=e.data.tod)}return Object(n.u)((function(){window.$msim.on(e.$IM.EVENT.JOIN_CHAT_ROOM,d),window.$msim.on(e.$IM.EVENT.LEAVE_CHAT_ROOM,l),window.$msim.on(e.$IM.EVENT.MESSAGE_GROUP_RECEIVED,u),window.$msim.on(e.$IM.EVENT.MESSAGE_GROUP_REVOKED,r),window.$msim.on(e.$IM.EVENT.MESSAGE_GROUP_DELETE,m),window.$msim.on(e.$IM.EVENT.GROUP_DESTROY,f),window.$msim.on(e.$IM.EVENT.UPDATE_GROUP_INFO,v),window.$msim.on(e.$IM.EVENT.UPDATE_GROUP_TOD,g),window.$msim.joinChatRoom({roomId:1641525634}).then((function(e){a.chatRoomInfo=e.data,window.$msim.getRoomMsgs({roomId:1641525634}).then((function(e){t.commit("updateRoomMsgs",e.data),s()}))}))})),Object(n.v)((function(){window.$msim.off(e.$IM.EVENT.JOIN_CHAT_ROOM),window.$msim.off(e.$IM.EVENT.LEAVE_CHAT_ROOM),window.$msim.off(e.$IM.EVENT.MESSAGE_GROUP_RECEIVED),window.$msim.off(e.$IM.EVENT.MESSAGE_GROUP_REVOKED),window.$msim.off(e.$IM.EVENT.MESSAGE_GROUP_DELETE),window.$msim.off(e.$IM.EVENT.GROUP_DESTROY),window.$msim.off(e.$IM.EVENT.UPDATE_GROUP_INFO),window.$msim.off(e.$IM.EVENT.UPDATE_GROUP_TOD),t.commit("clearRoomMsgs")})),{sendRef:c,msgListRef:i,roomId:1641525634,scrollB:s,resend:function(e){c.value.sendMsg(e)},leave:function(){window.$msim.leaveChatRoom({roomId:1641525634}).then((function(e){a.chatRoomInfo=null,o.push({name:"chat"})}))},data:a}}};o("ec00");q.render=function(e,t,o,i,s,d){var l=Object(n.E)("ChatRoomMsgList"),u=Object(n.E)("RoomInfo");return Object(n.w)(),Object(n.f)("div",a,[Object(n.g)("div",c,[Object(n.j)(l,{roomInfo:i.data.chatRoomInfo,ref:"msgListRef"},null,8,["roomInfo"])]),Object(n.j)(u,{chatRoomInfo:i.data.chatRoomInfo,roomId:i.roomId,onLeave:t[0]||(t[0]=function(e){return i.leave()})},null,8,["chatRoomInfo","roomId"])])},q.__scopeId="data-v-7200e74e";t.default=q},1933:function(e,t,o){},"338b":function(e,t,o){"use strict";o("c477")},"494f":function(e,t,o){"use strict";o("9ee1")},5978:function(e,t,o){"use strict";o("e6dd")},"65b2":function(e,t,o){},"9ee1":function(e,t,o){},c477:function(e,t,o){},e6dd:function(e,t,o){},e790:function(e,t,o){"use strict";o("1933")},ec00:function(e,t,o){"use strict";o("65b2")}}]);