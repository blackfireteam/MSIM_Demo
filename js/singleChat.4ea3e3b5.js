(window.webpackJsonp=window.webpackJsonp||[]).push([["singleChat"],{"080d":function(e,t,n){},1767:function(e,t,n){"use strict";n("34f7")},"34f7":function(e,t,n){},"44d0":function(e,t,n){},5339:function(e,t,n){},"54b0":function(e,t,n){},"58f1":function(e,t,n){},"58f2":function(e,t,n){"use strict";n("58f1")},"67fb":function(e,t,n){"use strict";n("54b0")},"69bb":function(e,t,n){"use strict";n("44d0")},"6b86":function(e,t,n){"use strict";n.r(t);var a=n("7a23"),c={class:"chat_cont"},o={class:"chat_left"},s={class:"chat_right"};var r=n("24ec"),i=n.n(r);Object(a.z)("data-v-5308b89d");var l={key:0,class:"message_wrapper"},u={key:1,class:"no_chat"},d=[Object(a.g)("img",{src:i.a,alt:""},null,-1),Object(a.g)("div",{class:"tip"},"No messages.",-1),Object(a.g)("div",{class:"des"},"You can search someone and send out a message first!",-1)];Object(a.x)();var f=n("5502"),b=n("5d7c");Object(a.z)("data-v-7e092ac2");var h={key:0,class:"has_more"},g=[Object(a.g)("span",{class:"has_more_tip"},"没有更多数据了",-1)];Object(a.x)();n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");var m=n("06c5");function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,c,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);s=!0);}catch(e){r=!0,c=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw c}}return o}}(e,t)||Object(m.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n("4160"),n("159b"),n("c740");var p=n("b4bb"),j=n("23ed"),O={components:{ScrollWrapper:j.a,MsgItem:p.a},props:{curChat:Object},setup:function(e){var t=Object(f.b)(),n=Object(a.l)().appContext.config.globalProperties,c=Object(a.A)({showImageViewer:!1,imageListIndex:0,hasMore:!0}),o=Object(a.B)("msgList"),s=Object(a.b)((function(){return t.state.msgList})),r=Object(a.b)((function(){var e=[];return s.value.forEach((function(t){t.type===n.$IM.TYPES.MSG_TYPE.Img&&e.push({url:t.url,onlyId:t.onlyId})})),e})),i=Object(a.b)((function(){var t=null;return s.value.forEach((function(n){var a;n.fromUid!==(null===(a=e.curChat)||void 0===a?void 0:a.uid)&&(t=n.onlyId)})),t})),l=!1,u=null,d=null;function b(e){t.commit("updateMsgs",e.data)}function h(e){t.commit("revokeMsgs",e.data)}function g(e){t.commit("deleteMsgs",e.data)}function m(e){t.commit("readMsgs",e.data)}function p(a){var o;l=!0,window.$msim.getMessageList({conversationID:null===(o=e.curChat)||void 0===o?void 0:o.conversationID,msgEnd:a}).then((function(e){var n=e.data.messages;c.hasMore=e.data.hasMore,n&&n.length>0&&(t.commit("addMsgs",n),a||j())})).catch((function(e){n.$message({type:"error",message:(null==e?void 0:e.msg)||e})})).finally((function(){l=!1}))}function j(){setTimeout((function(){var e;null===(e=o.value)||void 0===e||e.setScrollBottom()}),0)}function O(){u.pause(),d.stop(),u=null,d=null}return Object(a.L)((function(){return[e.curChat,s.value.length]}),(function(e,t){var n=v(e,2),a=n[0],c=n[1],s=v(t,2),r=s[0],i=s[1];if((null==a?void 0:a.conversationID)!==(null==r?void 0:r.conversationID)&&p(),c>i){var l,u=null===(l=o.value)||void 0===l?void 0:l.getScrollYData();if(!u||u.scrollHeight<=u.clientHeight)return;u.scrollHeight-u.scrollTop-u.clientHeight<100&&j()}})),Object(a.u)((function(){window.$msim.on(n.$IM.EVENT.MESSAGE_RECEIVED,b),window.$msim.on(n.$IM.EVENT.MESSAGE_REVOKED,h),window.$msim.on(n.$IM.EVENT.MESSAGE_DELETE,g),window.$msim.on(n.$IM.EVENT.MESSAGE_READ,m),0===s.value.length?p():j()})),Object(a.v)((function(){window.$msim.off(n.$IM.EVENT.MESSAGE_RECEIVED),window.$msim.off(n.$IM.EVENT.MESSAGE_REVOKED),window.$msim.off(n.$IM.EVENT.MESSAGE_DELETE),window.$msim.off(n.$IM.EVENT.MESSAGE_READ)})),{data:c,msgRef:o,revoke:function(e){window.$msim.revokeMessage({conversationID:e.conversationID,msgId:e.msgId}).then((function(t){e.type=31,n.$message({type:"success",message:"撤回成功"})})).catch((function(e){n.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},msgScroll:function(e){var t=e.scrollTop,n=e.clientHeight,a=e.scrollHeight;l||!1===c.hasMore||t<200&&a>n&&s.value&&s.value.length>0&&p(s.value[0].msgId)},scrollBottom:j,showPreview:function(e){e.type===n.$IM.TYPES.MSG_TYPE.Img&&(c.imageListIndex=r.value.findIndex((function(t){return t.onlyId===e.onlyId})),c.showImageViewer=!0)},playSound:function(e){d&&O(),d=e,(u=document.createElement("audio")).src=e.message.url,e.play();var t=u.play();u.addEventListener("ended",(function(){O()})),t&&t.catch((function(){O()}))},stopSound:O,seeFlash:function(e,t){(t?e.fromRead:e.toRead)||window.$msim.readFlashMessage({conversationID:e.conversationID,msgId:e.msgId}).then((function(a){t?e.fromRead=!0:e.toRead=!0,n.$message({type:"success",message:"查看成功"})})).catch((function(e){n.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},msgList:s,myLastMsgOnlyId:i}}};n("67fb");O.render=function(e,t,n,c,o,s){var r=Object(a.E)("MsgItem"),i=Object(a.E)("scroll-wrapper");return Object(a.w)(),Object(a.d)(i,{class:"message_list",ref:"msgRef",onScroll:c.msgScroll},{default:Object(a.M)((function(){return[c.data.hasMore?Object(a.e)("",!0):(Object(a.w)(),Object(a.f)("div",h,g)),(Object(a.w)(!0),Object(a.f)(a.a,null,Object(a.C)(c.msgList,(function(t){var o,s;return Object(a.w)(),Object(a.d)(r,{key:t.msgId,message:t,isSelf:t.fromUid!==(null===(o=n.curChat)||void 0===o?void 0:o.uid),msgLastRead:(null===(s=n.curChat)||void 0===s?void 0:s.msgLastRead)||0,myLastMsgOnlyId:c.myLastMsgOnlyId,onShowPreview:function(e){return c.showPreview(t)},onSeeFlash:function(e){var a;return c.seeFlash(t,t.fromUid!==(null===(a=n.curChat)||void 0===a?void 0:a.uid))},onPlaySound:c.playSound,onStopSound:c.stopSound,onRevoke:c.revoke,onResend:function(){return e.$emit("resendMsg",t)}},null,8,["message","isSelf","msgLastRead","myLastMsgOnlyId","onShowPreview","onSeeFlash","onPlaySound","onStopSound","onRevoke","onResend"])})),128))]})),_:1},8,["onScroll"])},O.__scopeId="data-v-7e092ac2";var I=O,w=n("54c4"),y={components:{MsgHeader:b.a,MessageList:I,SendMessage:w.a},setup:function(){var e=Object(f.b)(),t=Object(a.B)("sendMsg"),n=Object(a.B)("msgListWrapper");return{sendRef:t,msgListRef:n,scrollB:function(){n.value.scrollBottom()},resend:function(e){t.value.sendMsg(e)},curChat:Object(a.b)((function(){return e.state.curChat}))}}};n("69bb");y.render=function(e,t,n,c,o,s){var r,i=Object(a.E)("MsgHeader"),f=Object(a.E)("MessageList"),b=Object(a.E)("SendMessage");return null!==(r=c.curChat)&&void 0!==r&&r.conversationID?(Object(a.w)(),Object(a.f)("div",l,[Object(a.j)(i,{curChat:c.curChat},null,8,["curChat"]),Object(a.j)(f,{curChat:c.curChat,onResendMsg:c.resend,ref:"msgListRef"},null,8,["curChat","onResendMsg"]),Object(a.j)(b,{curChat:c.curChat,onScrollB:c.scrollB,ref:"sendRef"},null,8,["curChat","onScrollB"])])):(Object(a.w)(),Object(a.f)("div",u,d))},y.__scopeId="data-v-5308b89d";var E=y;Object(a.z)("data-v-c52d9d04");var M={class:"bar_right"},C={class:"header_warpper"},S={class:"header_bar"},_={class:"chat_dialog_footer"};Object(a.x)();n("d81d"),n("7db0");Object(a.z)("data-v-c8c15e08");var D={key:0,class:"badge"},L={class:"info"},$={class:"user_info"},V={class:"info_left"},T={class:"user_name wrap"},k={class:"is_online"},R={class:"last_msg_time"},x={class:"last_msg wrap"};Object(a.x)();var B=n("2095"),A={props:{chat:Object,isCurChat:Boolean,isOnline:Boolean,userInfo:{type:Object,default:{}}},setup:function(){return{formatLastTime:B.a}}};n("a115");A.render=function(e,t,n,c,o,s){return Object(a.w)(),Object(a.f)("div",{class:Object(a.q)(["chat_item",{active_item:n.isCurChat}])},[Object(a.g)("div",{class:"avatar",style:Object(a.r)({backgroundImage:"url("+n.userInfo.avatar||!1})},[!n.isCurChat&&n.chat.unread>0?(Object(a.w)(),Object(a.f)("span",D,Object(a.G)(n.chat.unread),1)):Object(a.e)("",!0)],4),Object(a.g)("div",L,[Object(a.g)("div",$,[Object(a.g)("div",V,[Object(a.g)("span",T,Object(a.G)(n.userInfo.nickName||n.chat.conversationID),1),Object(a.N)(Object(a.g)("span",k,null,512),[[a.K,n.isOnline]])]),Object(a.g)("span",R,Object(a.G)(c.formatLastTime(n.chat.showTime)),1)]),Object(a.g)("div",x,Object(a.G)(1===n.chat.showMsgType?"[图片]":2===n.chat.showMsgType?"[音频]":3===n.chat.showMsgType?"[视频]":7===n.chat.showMsgType?"[闪照]":31===n.chat.showMsgType?"[已撤回]":n.chat.showMsg),1)])],2)},A.__scopeId="data-v-c8c15e08";var G=A,N=n("2a52"),P=n("fb37"),H=n("71ca"),U={components:{Dialog:N.a,InputD:P.a,ButtonD:H.a,ChatItem:G,ScrollWrapper:j.a},setup:function(){var e=Object(a.l)().appContext.config.globalProperties,t=Object(f.b)(),n=Object(a.b)((function(){return t.state.curChat})),c=Object(a.b)((function(){return t.state.chatList})),o=Object(a.b)((function(){return t.state.profiles})),s=Object(a.b)((function(){return t.state.onlineUsers})),r=Object(a.A)({dialogVisible:!1,userId:null,hasMore:!0}),i=Object(a.B)("chatList");function l(e){var t=e.map((function(e){return{uid:e.uid}}));window.$msim.getProfileList(t)}function u(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];window.$msim.getConversationList({conversationID:a,pageSize:20}).then((function(e){var a=e.data.chats;r.hasMore=e.data.hasMore,a.length>0&&(l(a),c?t.commit("refreshChats",a):t.commit("updateChats",a),n.value.uid||d(a[0]))})).catch((function(t){e.$message({type:"error",message:(null==t?void 0:t.msg)||t})}))}function d(e){var a;(null===(a=n.value)||void 0===a?void 0:a.conversationID)!==(null==e?void 0:e.conversationID)&&t.commit("changeChat",e)}function b(){r.userId=null,r.dialogVisible=!1}return Object(a.u)((function(){c.value.length<20&&u()})),Object(a.L)((function(){var e;return null===(e=n.value)||void 0===e?void 0:e.unread}),(function(e,t){var a;e>0&&(a=n.value.conversationID,window.$msim.setMessageRead({conversationID:a}))})),{data:r,cancel:b,contact:function(){if(!r.userId||r.userId==t.state.curUserId||n.value&&r.userId==n.value.uid)b();else{var e=c.value.find((function(e){return e.uid==r.userId}));e||(e={conversationID:"C2C_"+r.userId,uid:r.userId},t.commit("addChat",e)),t.commit("changeChat",e),b()}},chatRef:i,chatList:c,curChat:n,userInfos:o,onlineUsers:s,chatScroll:function(e){var t=e.scrollTop,n=e.clientHeight,a=e.scrollHeight;if(!1!==r.hasMore){var o=c.value;if(t+n+100>=a)if(o&&o.length>0)u(o[o.length-1].conversationID)}},chatChange:d,refresh:function(){u(null,!0)}}}};n("1767");U.render=function(e,t,n,c,o,s){var r=Object(a.E)("ChatItem"),i=Object(a.E)("scroll-wrapper"),l=Object(a.E)("InputD"),u=Object(a.E)("ButtonD"),d=Object(a.E)("Dialog");return Object(a.w)(),Object(a.f)(a.a,null,[Object(a.g)("div",M,[Object(a.g)("div",C,[Object(a.g)("div",S,[Object(a.g)("i",{class:"iconfont icon-add",onClick:t[0]||(t[0]=function(e){return c.data.dialogVisible=!0})}),Object(a.g)("i",{class:"iconfont icon-refresh",onClick:t[1]||(t[1]=function(e){return c.refresh()})})])]),Object(a.j)(i,{class:"chat_list",ref:"chatRef",onScroll:c.chatScroll},{default:Object(a.M)((function(){return[(Object(a.w)(!0),Object(a.f)(a.a,null,Object(a.C)(c.chatList,(function(e){return Object(a.w)(),Object(a.d)(r,{key:e.conversationID,onClick:function(t){return c.chatChange(e)},isCurChat:e.conversationID===c.curChat.conversationID,chat:e,isOnline:c.onlineUsers.has(e.uid),userInfo:c.userInfos.get(e.uid)},null,8,["onClick","isCurChat","chat","isOnline","userInfo"])})),128))]})),_:1},8,["onScroll"])]),Object(a.j)(d,{title:"快速发起会话",modelValue:c.data.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=function(e){return c.data.dialogVisible=e}),"before-close":c.cancel,width:"400px"},{footer:Object(a.M)((function(){return[Object(a.g)("div",_,[Object(a.j)(u,{isBlock:!1,size:"small",type:"cancel",text:"取 消",onClick:c.cancel},null,8,["onClick"]),Object(a.j)(u,{isBlock:!1,size:"small",text:"确 定",onClick:c.contact},null,8,["onClick"])])]})),default:Object(a.M)((function(){return[Object(a.g)("div",null,[Object(a.j)(l,{modelValue:c.data.userId,"onUpdate:modelValue":t[2]||(t[2]=function(e){return c.data.userId=e}),maxlength:"11",placeholder:"用户手机号"},null,8,["modelValue"])])]})),_:1},8,["modelValue","before-close"])],64)},U.__scopeId="data-v-c52d9d04";var z={components:{ChatList:U,MessageWrapper:E},setup:function(){}};n("58f2");z.render=function(e,t,n,r,i,l){var u=Object(a.E)("ChatList"),d=Object(a.E)("MessageWrapper");return Object(a.w)(),Object(a.f)("div",c,[Object(a.g)("div",o,[Object(a.j)(u)]),Object(a.g)("div",s,[Object(a.j)(d)])])};t.default=z},a115:function(e,t,n){"use strict";n("5339")},f9d9:function(e,t,n){"use strict";n("080d")},fb37:function(e,t,n){"use strict";var a=n("7a23");Object(a.z)("data-v-6ed82cf2");var c={class:"input_wrapper"},o=["type","disabled","placeholder","maxlength"];Object(a.x)();n("a9e3"),n("a15b"),n("fb6a"),n("a630"),n("3ca3");var s={props:{modelValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"},disabled:Boolean,errMsg:String,maxlength:{type:String,default:null},placeholder:String},setup:function(e,t){return{handleInput:function(n){var a=n.target.value;e.maxlength&&(a=Array.from(a).slice(0,Number(e.maxlength)).join("")),t.emit("update:modelValue",a),t.emit("input",a)},handleBlur:function(e){t.emit("blur",e)},handleChange:function(e){t.emit("change",e.target.value)},handleKeydown:function(e){t.emit("keydown",e)}}}};n("f9d9");s.render=function(e,t,n,s,r,i){return Object(a.w)(),Object(a.f)("div",c,[Object(a.N)(Object(a.g)("input",{class:Object(a.q)(["input_default",{err:n.errMsg,disabled_input:n.disabled}]),type:n.inputType,"onUpdate:modelValue":t[0]||(t[0]=function(e){return n.modelValue=e}),spellcheck:"false",autocapitalize:"off",autocomplete:"off",disabled:n.disabled,placeholder:n.placeholder,maxlength:n.maxlength,onInput:t[1]||(t[1]=function(){return s.handleInput&&s.handleInput.apply(s,arguments)}),onBlur:t[2]||(t[2]=Object(a.P)((function(){return s.handleBlur&&s.handleBlur.apply(s,arguments)}),["prevent"])),onChange:t[3]||(t[3]=function(){return s.handleChange&&s.handleChange.apply(s,arguments)}),onKeydown:t[4]||(t[4]=function(){return s.handleKeydown&&s.handleKeydown.apply(s,arguments)})},null,42,o),[[a.I,n.modelValue]])])},s.__scopeId="data-v-6ed82cf2";t.a=s}}]);