(window.webpackJsonp=window.webpackJsonp||[]).push([["singleChat"],{"10a7":function(e,t,n){},"3dec":function(e,t,n){"use strict";n("10a7")},"58f1":function(e,t,n){},"58f2":function(e,t,n){"use strict";n("58f1")},6221:function(e,t,n){"use strict";n("b096")},"62a1":function(e,t,n){"use strict";n("f338")},"6b86":function(e,t,n){"use strict";n.r(t);var a=n("7a23"),c={class:"chat_cont"},o={class:"chat_left"},s={class:"chat_right"};var r=n("24ec"),l=n.n(r);Object(a.z)("data-v-1dfb9302");var i={key:0,class:"message_wrapper"},u={key:1,class:"no_chat"},d=[Object(a.g)("img",{src:l.a,alt:""},null,-1),Object(a.g)("div",{class:"tip"},"No messages.",-1),Object(a.g)("div",{class:"des"},"You can search someone and send out a message first!",-1)];Object(a.x)();var f=n("5502"),b=n("5d7c");Object(a.z)("data-v-5898b74a");var h={key:0,class:"has_more"},g=[Object(a.g)("span",{class:"has_more_tip"},"没有更多数据了",-1)];Object(a.x)();n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0");var v=n("06c5");function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,c,o=[],s=!0,r=!1;try{for(n=n.call(e);!(s=(a=n.next()).done)&&(o.push(a.value),!t||o.length!==t);s=!0);}catch(e){r=!0,c=e}finally{try{s||null==n.return||n.return()}finally{if(r)throw c}}return o}}(e,t)||Object(v.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n("4160"),n("159b"),n("c740");var O=n("b4bb"),j=n("23ed"),p={components:{ScrollWrapper:j.a,MsgItem:O.a},props:{curChat:Object},setup:function(e){var t=Object(f.b)(),n=Object(a.l)().appContext.config.globalProperties,c=Object(a.A)({showImageViewer:!1,imageListIndex:0,hasMore:!0}),o=Object(a.B)("msgList"),s=Object(a.b)((function(){return t.state.msgList})),r=Object(a.b)((function(){var e=[];return s.value.forEach((function(t){t.type===n.$IM.TYPES.MSG_TYPE.Img&&e.push({url:t.url,onlyId:t.onlyId})})),e})),l=Object(a.b)((function(){var t=null;return s.value.forEach((function(n){var a;n.fromUid!==(null===(a=e.curChat)||void 0===a?void 0:a.uid)&&(t=n.onlyId)})),t})),i=!1,u=null,d=null;function b(e){t.commit("updateMsgs",e.data)}function h(e){t.commit("revokeMsgs",e.data)}function g(e){t.commit("deleteMsgs",e.data)}function v(e){t.commit("readFlashMsg",e.data)}function O(a){var o;i=!0,n.$msim.getMessageList({conversationID:null===(o=e.curChat)||void 0===o?void 0:o.conversationID,msgEnd:a}).then((function(e){var n=e.data.messages;c.hasMore=e.data.hasMore,n&&n.length>0&&(t.commit("addMsgs",n),a||j())})).catch((function(e){n.$message({type:"error",message:(null==e?void 0:e.msg)||e})})).finally((function(){i=!1}))}function j(){setTimeout((function(){var e;null===(e=o.value)||void 0===e||e.setScrollBottom()}),0)}function p(){u.pause(),d.stop(),u=null,d=null}return Object(a.M)((function(){return[e.curChat,s.value.length]}),(function(e,t){var n=m(e,2),a=n[0],c=n[1],s=m(t,2),r=s[0],l=s[1];if((null==a?void 0:a.conversationID)!==(null==r?void 0:r.conversationID)&&O(),c>l){var i,u=null===(i=o.value)||void 0===i?void 0:i.getScrollYData();if(!u||u.scrollHeight<=u.clientHeight)return;u.scrollHeight-u.scrollTop-u.clientHeight<100&&j()}})),Object(a.u)((function(){n.$msim.on(n.$IM.EVENT.MESSAGE_RECEIVED,b),n.$msim.on(n.$IM.EVENT.MESSAGE_REVOKED,h),n.$msim.on(n.$IM.EVENT.MESSAGE_DELETE,g),n.$msim.on(n.$IM.EVENT.MESSAGE_READ_FLASH,v),0===s.value.length?O():j()})),Object(a.v)((function(){n.$msim.off(n.$IM.EVENT.MESSAGE_RECEIVED),n.$msim.off(n.$IM.EVENT.MESSAGE_REVOKED),n.$msim.off(n.$IM.EVENT.MESSAGE_DELETE),n.$msim.off(n.$IM.EVENT.MESSAGE_READ_FLASH)})),{data:c,msgRef:o,revoke:function(e){n.$msim.revokeMessage({conversationID:e.conversationID,msgId:e.msgId}).then((function(t){e.type=31,n.$message({type:"success",message:"撤回成功"})})).catch((function(e){n.$message({type:"error",message:(null==e?void 0:e.msg)||e})}))},msgScroll:function(e){var t=e.scrollTop,n=e.clientHeight,a=e.scrollHeight;i||!1===c.hasMore||t<200&&a>n&&s.value&&s.value.length>0&&O(s.value[0].msgId)},scrollBottom:j,showPreview:function(e){e.type===n.$IM.TYPES.MSG_TYPE.Img&&(c.imageListIndex=r.value.findIndex((function(t){return t.onlyId===e.onlyId})),c.showImageViewer=!0)},playSound:function(e){d&&p(),d=e,(u=document.createElement("audio")).src=e.message.url,e.play();var t=u.play();u.addEventListener("ended",(function(){p()})),t&&t.catch((function(){p()}))},stopSound:p,seeFlash:function(e,t){t?e.fromRead:e.toRead},msgList:s,myLastMsgOnlyId:l}}};n("6221");p.render=function(e,t,n,c,o,s){var r=Object(a.E)("MsgItem"),l=Object(a.E)("scroll-wrapper");return Object(a.w)(),Object(a.d)(l,{class:"message_list",ref:"msgRef",onScroll:c.msgScroll},{default:Object(a.N)((function(){return[c.data.hasMore?Object(a.e)("",!0):(Object(a.w)(),Object(a.f)("div",h,g)),(Object(a.w)(!0),Object(a.f)(a.a,null,Object(a.C)(c.msgList,(function(t){var o,s;return Object(a.w)(),Object(a.d)(r,{key:t.msgId,message:t,isSelf:t.fromUid!==(null===(o=n.curChat)||void 0===o?void 0:o.uid),msgLastRead:(null===(s=n.curChat)||void 0===s?void 0:s.msgLastRead)||0,myLastMsgOnlyId:c.myLastMsgOnlyId,onShowPreview:function(e){return c.showPreview(t)},onSeeFlash:function(e){var a;return c.seeFlash(t,t.fromUid!==(null===(a=n.curChat)||void 0===a?void 0:a.uid))},onPlaySound:c.playSound,onStopSound:c.stopSound,onRevoke:c.revoke,onResend:function(){return e.$emit("resendMsg",t)}},null,8,["message","isSelf","msgLastRead","myLastMsgOnlyId","onShowPreview","onSeeFlash","onPlaySound","onStopSound","onRevoke","onResend"])})),128))]})),_:1},8,["onScroll"])},p.__scopeId="data-v-5898b74a";var I=p,y=n("54c4"),E={components:{MsgHeader:b.a,MessageList:I,SendMessage:y.a},setup:function(){var e=Object(f.b)(),t=Object(a.B)("sendMsg"),n=Object(a.B)("msgListWrapper");return{sendRef:t,msgListRef:n,scrollB:function(){n.value.scrollBottom()},resend:function(e){t.value.sendMsg(e)},curChat:Object(a.b)((function(){return e.state.curChat}))}}};n("3dec");E.render=function(e,t,n,c,o,s){var r,l,f=Object(a.E)("MsgHeader"),b=Object(a.E)("MessageList"),h=Object(a.E)("SendMessage");return null!==(r=c.curChat)&&void 0!==r&&r.conversationID?(Object(a.w)(),Object(a.f)("div",i,[Object(a.j)(f,{curChat:c.curChat},null,8,["curChat"]),Object(a.j)(b,{curChat:c.curChat,onResendMsg:c.resend,ref:"msgListRef"},null,8,["curChat","onResendMsg"]),Object(a.j)(h,{to:null===(l=c.curChat)||void 0===l?void 0:l.uid,onScrollB:c.scrollB,ref:"sendRef"},null,8,["to","onScrollB"])])):(Object(a.w)(),Object(a.f)("div",u,d))},E.__scopeId="data-v-1dfb9302";var M=E;Object(a.z)("data-v-1e51cf94");var S={class:"bar_right"},C={class:"header_warpper"},w={class:"header_bar"},_={class:"chat_dialog_footer"};Object(a.x)();n("7db0");Object(a.z)("data-v-1526a08c");var L={class:"avatar"},D={class:"avatar_img"},T={key:0,class:"badge"},V={class:"info"},k={class:"user_info"},$={class:"info_left"},R={class:"user_name wrap"},B={class:"is_online"},x={class:"last_msg_time"},A={class:"last_msg wrap"};Object(a.x)();var H=n("2095"),N={props:{chat:Object,isCurChat:Boolean,isOnline:Boolean,userInfo:{type:Object,default:{}}},setup:function(){return{formatLastTime:H.a}}};n("c738");N.render=function(e,t,n,c,o,s){var r=Object(a.F)("lazy");return Object(a.w)(),Object(a.f)("div",{class:Object(a.q)(["chat_item",{active_item:n.isCurChat}])},[Object(a.g)("div",L,[Object(a.O)(Object(a.g)("img",D,null,512),[[r,n.userInfo.avatar]]),!n.isCurChat&&n.chat.unread>0?(Object(a.w)(),Object(a.f)("span",T,Object(a.H)(n.chat.unread),1)):Object(a.e)("",!0)]),Object(a.g)("div",V,[Object(a.g)("div",k,[Object(a.g)("div",$,[Object(a.g)("span",R,Object(a.H)(n.userInfo.nickName||n.chat.conversationID),1),Object(a.O)(Object(a.g)("span",B,null,512),[[a.L,n.isOnline]])]),Object(a.g)("span",x,Object(a.H)(c.formatLastTime(n.chat.showTime)),1)]),Object(a.g)("div",A,Object(a.H)(1===n.chat.showMsgType?"[图片]":2===n.chat.showMsgType?"[音频]":3===n.chat.showMsgType?"[视频]":4===n.chat.showMsgType?"[位置]":6===n.chat.showMsgType?"[自定义表情]":7===n.chat.showMsgType?"[闪照]":31===n.chat.showMsgType?"[已撤回]":n.chat.showMsg),1)])],2)},N.__scopeId="data-v-1526a08c";var P=N,z=n("2a52"),G=n("fb37"),U=n("71ca"),F={components:{Dialog:z.a,InputD:G.a,ButtonD:U.a,ChatItem:P,ScrollWrapper:j.a},setup:function(){var e=Object(a.l)().appContext.config.globalProperties,t=Object(f.b)(),n=Object(a.b)((function(){return t.state.curChat})),c=Object(a.b)((function(){return t.state.chatList})),o=Object(a.b)((function(){return t.state.profiles})),s=Object(a.b)((function(){return t.state.onlineUsers})),r=Object(a.A)({dialogVisible:!1,userId:null,hasMore:!0}),l=Object(a.B)("chatList");function i(t){var n=[];t.forEach((function(e){var t=o.value.get(e.uid);t&&t.custom||n.push({uid:e.uid})})),n.length>0&&e.$msim.getProfileList(n)}function u(a){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.$msim.getConversationList({conversationID:a,pageSize:20}).then((function(e){var a=e.data.chats;r.hasMore=e.data.hasMore,a.length>0&&(i(a),c?t.commit("refreshChats",a):t.commit("updateChats",a),n.value.uid||d(a[0]))})).catch((function(t){e.$message({type:"error",message:(null==t?void 0:t.msg)||t})}))}function d(e){var a;(null===(a=n.value)||void 0===a?void 0:a.conversationID)!==(null==e?void 0:e.conversationID)&&t.commit("changeChat",e)}function b(){r.userId=null,r.dialogVisible=!1}return Object(a.u)((function(){c.value.length<20&&u()})),Object(a.M)((function(){var e;return null===(e=n.value)||void 0===e?void 0:e.unread}),(function(t,a){var c;t>0&&(c=n.value.conversationID,e.$msim.setMessageRead({conversationID:c}))})),{data:r,cancel:b,contact:function(){if(!r.userId||r.userId==t.state.curUserId||n.value&&r.userId==n.value.uid)b();else{var e=c.value.find((function(e){return e.uid==r.userId}));e||(e={conversationID:"C2C_"+r.userId,uid:r.userId},t.commit("addChat",e)),t.commit("changeChat",e),b()}},chatRef:l,chatList:c,curChat:n,userInfos:o,onlineUsers:s,chatScroll:function(e){var t=e.scrollTop,n=e.clientHeight,a=e.scrollHeight;if(!1!==r.hasMore){var o=c.value;if(t+n+100>=a)if(o&&o.length>0)u(o[o.length-1].conversationID)}},chatChange:d,refresh:function(){u(null,!0)}}}};n("c812");F.render=function(e,t,n,c,o,s){var r=Object(a.E)("ChatItem"),l=Object(a.E)("scroll-wrapper"),i=Object(a.E)("InputD"),u=Object(a.E)("ButtonD"),d=Object(a.E)("Dialog");return Object(a.w)(),Object(a.f)(a.a,null,[Object(a.g)("div",S,[Object(a.g)("div",C,[Object(a.g)("div",w,[Object(a.g)("i",{class:"iconfont icon-add",onClick:t[0]||(t[0]=function(e){return c.data.dialogVisible=!0})}),Object(a.g)("i",{class:"iconfont icon-refresh",onClick:t[1]||(t[1]=function(e){return c.refresh()})})])]),Object(a.j)(l,{class:"chat_list",ref:"chatRef",onScroll:c.chatScroll},{default:Object(a.N)((function(){return[(Object(a.w)(!0),Object(a.f)(a.a,null,Object(a.C)(c.chatList,(function(e){return Object(a.w)(),Object(a.d)(r,{key:e.conversationID,onClick:function(t){return c.chatChange(e)},isCurChat:e.conversationID===c.curChat.conversationID,chat:e,isOnline:c.onlineUsers.has(e.uid),userInfo:c.userInfos.get(e.uid)},null,8,["onClick","isCurChat","chat","isOnline","userInfo"])})),128))]})),_:1},8,["onScroll"])]),Object(a.j)(d,{title:"快速发起会话",modelValue:c.data.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=function(e){return c.data.dialogVisible=e}),"before-close":c.cancel,width:"400px"},{footer:Object(a.N)((function(){return[Object(a.g)("div",_,[Object(a.j)(u,{isBlock:!1,size:"small",type:"cancel",text:"取 消",onClick:c.cancel},null,8,["onClick"]),Object(a.j)(u,{isBlock:!1,size:"small",text:"确 定",onClick:c.contact},null,8,["onClick"])])]})),default:Object(a.N)((function(){return[Object(a.g)("div",null,[Object(a.j)(i,{modelValue:c.data.userId,"onUpdate:modelValue":t[2]||(t[2]=function(e){return c.data.userId=e}),maxlength:"11",placeholder:"用户手机号"},null,8,["modelValue"])])]})),_:1},8,["modelValue","before-close"])],64)},F.__scopeId="data-v-1e51cf94";var K={components:{ChatList:F,MessageWrapper:M},setup:function(){}};n("58f2");K.render=function(e,t,n,r,l,i){var u=Object(a.E)("ChatList"),d=Object(a.E)("MessageWrapper");return Object(a.w)(),Object(a.f)("div",c,[Object(a.g)("div",o,[Object(a.j)(u)]),Object(a.g)("div",s,[Object(a.j)(d)])])};t.default=K},"704a":function(e,t,n){},a882:function(e,t,n){},b096:function(e,t,n){},c738:function(e,t,n){"use strict";n("a882")},c812:function(e,t,n){"use strict";n("704a")},f338:function(e,t,n){},fb37:function(e,t,n){"use strict";var a=n("7a23");Object(a.z)("data-v-55e7507a");var c={class:"input_wrapper"},o=["type","readonly","disabled","placeholder","maxlength"];Object(a.x)();n("a9e3"),n("a15b"),n("fb6a"),n("a630"),n("3ca3");var s={props:{modelValue:{type:[String,Number],default:""},inputType:{type:String,default:"text"},icon:String,readonly:Boolean,disabled:Boolean,errMsg:String,maxlength:{type:String,default:null},placeholder:String},setup:function(e,t){return{handleInput:function(n){var a=n.target.value;e.maxlength&&(a=Array.from(a).slice(0,Number(e.maxlength)).join("")),t.emit("update:modelValue",a),t.emit("input",a)},handleBlur:function(e){t.emit("blur",e.target.value)},handleChange:function(e){t.emit("change",e.target.value)},handleKeydown:function(e){t.emit("keydown",e)}}}};n("62a1");s.render=function(e,t,n,s,r,l){return Object(a.w)(),Object(a.f)("div",c,[Object(a.O)(Object(a.g)("input",{class:Object(a.q)(["input_default",{err:n.errMsg,disabled_input:n.disabled,icon_paddding:n.icon}]),type:n.inputType,"onUpdate:modelValue":t[0]||(t[0]=function(e){return n.modelValue=e}),spellcheck:"false",autocapitalize:"off",autocomplete:"off",readonly:n.readonly,disabled:n.disabled,placeholder:n.placeholder,maxlength:n.maxlength,onInput:t[1]||(t[1]=function(){return s.handleInput&&s.handleInput.apply(s,arguments)}),onBlur:t[2]||(t[2]=Object(a.Q)((function(){return s.handleBlur&&s.handleBlur.apply(s,arguments)}),["prevent"])),onChange:t[3]||(t[3]=function(){return s.handleChange&&s.handleChange.apply(s,arguments)}),onKeydown:t[4]||(t[4]=function(){return s.handleKeydown&&s.handleKeydown.apply(s,arguments)})},null,42,o),[[a.J,n.modelValue]]),n.icon?(Object(a.w)(),Object(a.f)("i",{key:0,class:Object(a.q)(["iconfont",n.icon])},null,2)):Object(a.e)("",!0)])},s.__scopeId="data-v-55e7507a";t.a=s}}]);